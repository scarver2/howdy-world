# nginx/javascript-react.conf
# location /javascript-react/ {
#   # Vite dev server running inside the compose network
#   proxy_pass http://javascript-react:5173/;

#   proxy_http_version 1.1;

#   # WebSocket / HMR support
#   proxy_set_header Upgrade $http_upgrade;
#   proxy_set_header Connection "upgrade";

#   # Usual proxy headers
#   proxy_set_header Host $host;
#   proxy_set_header X-Real-IP $remote_addr;
#   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#   proxy_set_header X-Forwarded-Proto $scheme;
# }

# nginx/javascript-react.conf
# location /javascript-react/ {
#   # Serve the built Vite output from the nginx container filesystem.
#   # This path assumes we mount the dist/ into /usr/share/nginx/html/javascript-react/
#   alias /usr/share/nginx/html/javascript-react/;

#   # SPA fallback (important for client-side routing)
#   try_files $uri $uri/ /javascript-react/index.html;
# }


# nginx/conf.d/javascript-react.conf

# Optional: normalize /javascript-react to /javascript-react/
# location = /javascript-react {
#   return 301 /javascript-react/;
# }

# location ^~ /javascript-react/ {
#   # This is where you mount the Vite dist output inside the nginx container:
#   # /usr/share/nginx/html/javascript-react/index.html must exist.
#   alias /usr/share/nginx/html/javascript-react/;

#   index index.html;

#   # IMPORTANT:
#   # With `alias`, the SPA fallback should be to `/index.html` (filesystem under alias),
#   # not `/javascript-react/index.html` (a URI that re-enters the same location).
#   #
#   # `=404` prevents rewrite cycles if index.html is missing.
#   try_files $uri $uri/ /index.html =404;
# }

# /nginx/javascript-react.conf

# Normalize missing trailing slash
location = /javascript-react {
  return 301 /javascript-react/;
}

# Production: serve built Vite dist (mounted into the nginx container)
# location ^~ /javascript-react/ {
#   # Expect: /usr/share/nginx/html/javascript-react/index.html
#   alias /usr/share/nginx/html/javascript-react/;

#   index index.html;

#   # SPA fallback (and avoid redirect cycles if index.html is missing)
#   try_files $uri $uri/ /index.html =404;
# }


# nginx/conf.d/javascript-react.conf

location = /javascript-react {
  return 301 /javascript-react/;
}

location ^~ /javascript-react/ {
  # Serve the built Vite output mounted from the host:
  # ./javascript-react/dist  ->  /srv/javascript-react-dist
  alias /srv/javascript-react-dist/;

  index index.html;

  # SPA fallback (and avoid redirect cycles if index.html is missing)
  try_files $uri $uri/ /index.html =404;
}
