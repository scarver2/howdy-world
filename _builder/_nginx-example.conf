# Example nginx.conf
# TODO: The finale bersion will not have hard-coded references to apps and configuration
worker_processes  1;

events {
    worker_connections 1024;
}

http {
    # Basic log / mime setup
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    # Upstreams for each language service (container name + internal port)
    upstream ada_app     { server ada-app:8006; }
    upstream fortran_app { server fortran-app:8008; }
    upstream go_app      { server go-app:8002; }
    upstream java_app    { server java-app:8009; }
    upstream lisp_app    { server lisp-app:8007; }
    upstream odin_app    { server odin-app:8003; }
    upstream perl_app    { server perl-app:8005; }
    upstream rust_app    { server rust-app:8001; }
    upstream zig_app     { server zig-app:8004; }

    server {
        listen 80;
        server_name _;

        # Ada: http://localhost:8080/ada
        location /ada/ {
            proxy_pass http://ada_app/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Fortran: http://localhost:8080/fortran
        location /fortran/ {
            proxy_pass http://fortran_app/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Go: http://localhost:8080/go
        location /go/ {
            proxy_pass http://go_app/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Java: http://localhost:8080/java
        location /java/ {
            proxy_pass http://java_app/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Lisp: http://localhost:8080/lisp
        location /lisp/ {
            proxy_pass http://lisp_app/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Odin: http://localhost:8080/odin
        location /odin/ {
            proxy_pass http://odin_app/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Perl: http://localhost:8080/perl
        location /perl/ {
            proxy_pass http://perl_app/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Rust: http://localhost:8080/rust
        location /rust/ {
            proxy_pass http://rust_app/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Zig: http://localhost:8080/zig
        location /zig/ {
            proxy_pass http://zig_app/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
