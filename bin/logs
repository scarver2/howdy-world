#!/usr/bin/env bash
# bin/logs

source "$(dirname "$0")/_lib.sh"
cd "$ROOT_DIR"

usage() {
  cat <<'USAGE'
Usage:
  bin/logs                     # tail logs for all services
  bin/logs <service>           # tail logs for one service
  bin/logs <service> -f        # follow
  bin/logs -f                  # follow all
  bin/logs --list              # list services

Examples:
  bin/logs nginx -f
  bin/logs rust-leptos
  bin/logs -f
USAGE
}

if [[ "${1:-}" == "-h" || "${1:-}" == "--help" ]]; then
  usage
  exit 0
fi

banner

if [[ "${1:-}" == "--list" ]]; then
  services
  exit 0
fi

SERVICE=""
if [[ $# -gt 0 && "${1:0:1}" != "-" ]]; then
  SERVICE="$1"
  shift
fi

TAIL_LINES="${TAIL_LINES:-200}"

if [[ -n "$SERVICE" ]]; then
  validate_service "$SERVICE"
  compose logs --tail="$TAIL_LINES" "$@" "$SERVICE"
else
  compose logs --tail="$TAIL_LINES" "$@"
fi
