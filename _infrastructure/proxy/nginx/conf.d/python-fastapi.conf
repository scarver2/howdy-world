# nginx/conf.d/python-fastapi.conf

# Canonical trailing-slash for the subpath
location = /python-fastapi {
  return 301 /python-fastapi/;
}

# Proxy the subpath to the FastAPI container, stripping the prefix
location ^~ /python-fastapi/ {
  proxy_http_version 1.1;

  proxy_set_header Host              $host;
  proxy_set_header X-Real-IP         $remote_addr;
  proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto $scheme;

  # IMPORTANT: trailing slash on proxy_pass strips "/python-fastapi/" prefix
  # /python-fastapi/foo -> http://python-fastapi:8000/foo
  proxy_pass http://python-fastapi:8000/;
}